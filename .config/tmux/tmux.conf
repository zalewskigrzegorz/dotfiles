# Nushell-specific environment fix
set-option -g update-environment "DISPLAY SSH_ASKPASS SSH_AGENT_PID SSH_CONNECTION WINDOWID XAUTHORITY PATH NU_LIB_DIRS NU_PLUGIN_DIRS"
set-option -g default-command "exec nu"

# Change prefix from ctrl-b to ctrl-space (better for neovim users)
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Split panes using | and - (with current path)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Renumber windows when one is closed
set -g renumber-windows on

# Enable mouse support
set -g mouse on

# Increase scrollback buffer size
set -g history-limit 50014

# Faster command sequences (important for neovim)
set -s escape-time 0
set -g repeat-time 300

# Refresh status line every 10 seconds (performance optimized)
set -g status-interval 10

# Focus events enabled for terminals that support them (important for neovim)
set -g focus-events on

# Easy config reload
bind r source-file ~/.config/tmux/tmux.conf \; display-message "ü¶Ñ XDG tmux.conf reloaded!"

# STATUS BAR ON TOP
set -g status-position top

# TPM Plugin Manager (must be first)
set -g @plugin 'tmux-plugins/tpm'

# Plugins
set -g @plugin 'tmux-plugins/tmux-copycat'       # Search with prefix + /
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'  # Visual indicator
set -g @plugin 'jaclu/tmux-menus'               # Interactive menus
set -g @plugin 'dracula/tmux'

set -g @dracula-show-left-icon "ü¶Ñ #W"

# Hide battery and other widgets
set -g @dracula-show-battery false
set -g @dracula-show-network false
set -g @dracula-show-weather false
set -g @dracula-show-time true  # Keep only time
set -g @dracula-show-location false

# Plugin settings for better prefix visibility
set -g @prefix_highlight_fg '#22212C'
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_copy_mode_attr 'fg=#22212C,bg=#FFFF80'
set -g @prefix_highlight_prefix_prompt 'üöÄ CTRL-SPACE'
set -g @prefix_highlight_copy_prompt 'üìã COPY'
set -g @prefix_highlight_output_prefix ' '
set -g @prefix_highlight_output_suffix ' '

# Neovim-friendly settings
set -g @prefix_highlight_empty_has_affixes 'on'
set -g @prefix_highlight_empty_prompt '‚≠ê'

# Better pane navigation (vim-like)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes with vim-like keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Copy mode improvements (vim-like)
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi r send -X rectangle-toggle


# Navi cheatsheet config - FIXED: Use 'b' key as you wanted
bind-key -N "Open Navi (cheat sheets)" b split-window -l 20 \
  'selected=$(navi --print); tmux send-keys -t {last} "$selected"'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.config/tmux/plugins/tpm/tpm'
